<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Map - BitVille District</title>
    <link rel="stylesheet" href="styles.css"> 
    <meta name="google-site-verification" content="QF5Fs7Cen8vNbcwE-ApVxyumFPuU3UWBVRiSD15RWIw">
</head>
<body>
    <!-- Header with Logo and Auth buttons -->
    <header id="header">
        <div id="nav-container">
            <a href="https://rainbowland.org/" target="_blank" id="logo-link">
                <img src="images/logo-r.webp" alt="Logo" id="logo">
            </a>
            <div id="auth-buttons">
                <button onclick="login()" id="login-btn">Login</button>
                <button onclick="logout()" id="logout-btn" style="display: none;">Logout</button>
            </div>
        </div>
    </header>

    <div id="title-container">
        <h1 id="map-title">BitVille District</h1>
        <h2 id="map-subtitle">
            The BitVille district's 1,936 individual LAND parcels stretch from (178, 118) to (221, 118) and from (178, 161) to (221, 161). It is part of The Rainbowland Metaverse.
        </h2>
    </div>

    <!-- Container for the map -->
    <div id="map-container"></div>

    <!-- Pop-up for plot details -->
    <div id="popup" class="popup" style="display:none;">
        <div class="popup-content">
            <span class="close-button">&times;</span>
            <img id="popup-image" src="" alt="Plot Image">
            <h3 id="popup-title">Plot Details</h3>
            <div class="button-container">
                <a id="mint-me-button" class="mint-me-button" href="#" target="_blank">Mint with Crypto</a>
                <a id="mint-paypal-button" class="mint-paypal-button" href="#" target="_blank">Mint with PayPal</a>
            </div>
            <p><strong>ğŸŒ† District:</strong> <span id="popup-district"></span></p>
            <p><strong>ğŸŒŸ Rarity:</strong> <span id="popup-rarity"></span></p>
            <p><strong>ğŸ’° Minerals:</strong> <span id="popup-minerals"></span></p>
            <p><strong>ğŸ’§ Water:</strong> <span id="popup-water"></span></p>
            <p><strong>ğŸ  Land Type:</strong> <span id="popup-land-type"></span></p>
            <p><strong>ğŸ“ˆ Income:</strong> <span id="popup-income"></span></p>
            <p><strong>ğŸŒŠ View:</strong> <span id="popup-view"></span></p>
            <p><strong>ğŸ“¦ Storage:</strong> <span id="popup-storage"></span></p>
        </div>
    </div>

    <!-- Sign-up Pop-up -->
    <div id="signup-popup" class="popup" style="display: none;">
        <div class="popup-content signup-popup-content">
            <span class="close-button" onclick="closeSignupPopup()">&times;</span>
            <h3>Join the Early Access</h3>
            <p>Sign up for early access to participate in the game testing!</p>
            <input type="email" id="email-input" placeholder="Enter your email" required>
            <button id="signup-button">Sign Up</button>
        </div>
    </div>

    <!-- Include EmailJS SDK -->
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
    <script type="text/javascript">
       (function(){
          emailjs.init("ZFUUgFIGL-KrMtI_y"); // Replace with your actual public key
       })();
    </script>

    <!-- Include Auth0 JS SDK -->
    <script src="https://cdn.auth0.com/js/auth0/9.18.0/auth0.min.js"></script>

    <script type="text/javascript">
      // Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ¹Ñ‚Ğµ ÑĞºĞ·ĞµĞ¼Ğ¿Ğ»ÑÑ€ Auth0
      const auth0 = new auth0.WebAuth({
        domain: 'https://bitville.web.app',  // Ğ—Ğ°Ğ¼ĞµĞ½Ğ¸Ñ‚Ğµ YOUR_DOMAIN Ğ½Ğ° Ğ²Ğ°Ñˆ Ğ´Ğ¾Ğ¼ĞµĞ½ Ğ² Auth0
        clientID: 'JlebraHVInbaQikTi63xWhxjB8uOtMLP',  // Ğ—Ğ°Ğ¼ĞµĞ½Ğ¸Ñ‚Ğµ YOUR_CLIENT_ID Ğ½Ğ° Ğ²Ğ°Ñˆ Client ID
        redirectUri: window.location.origin,  // URL Ğ´Ğ»Ñ Ğ¿ĞµÑ€ĞµĞ½Ğ°Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ Ğ¿Ğ¾ÑĞ»Ğµ Ğ²Ñ…Ğ¾Ğ´Ğ°
        responseType: 'token id_token',  // Ğ¢Ğ¸Ğ¿ Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ°
        scope: 'openid profile email'  // Ğ—Ğ°Ğ¿Ñ€Ğ°ÑˆĞ¸Ğ²Ğ°ĞµĞ¼Ñ‹Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ
      });

      // Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ñ Ğ´Ğ»Ñ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ¸ Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ° Ğ¾Ñ‚ Auth0 Ğ¿Ğ¾ÑĞ»Ğµ Ğ²Ñ…Ğ¾Ğ´Ğ°
      function handleAuthentication() {
        auth0.parseHash((err, authResult) => {
          if (authResult && authResult.accessToken && authResult.idToken) {
            // Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ÑĞµĞ¼ Ñ‚Ğ¾ĞºĞµĞ½Ñ‹ Ğ² Ğ»Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ğ¾Ğ¼ Ñ…Ñ€Ğ°Ğ½Ğ¸Ğ»Ğ¸Ñ‰Ğµ
            localStorage.setItem('access_token', authResult.accessToken);
            localStorage.setItem('id_token', authResult.idToken);

            // ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ¾ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ğµ Ğ¸ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ÑĞµĞ¼ Ğ² Ğ»Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ğ¾Ğµ Ñ…Ñ€Ğ°Ğ½Ğ¸Ğ»Ğ¸Ñ‰Ğµ
            auth0.client.userInfo(authResult.accessToken, (err, profile) => {
              if (profile) {
                localStorage.setItem('profile', JSON.stringify(profile));
                console.log("User profile: ", profile);
                document.getElementById('login-btn').style.display = 'none';
                document.getElementById('logout-btn').style.display = 'block';
              }
            });
          } else if (err) {
            console.error("Error: ", err);
          }
        });
      }

      // Ğ’Ñ…Ğ¾Ğ´ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
      function login() {
        auth0.authorize(); // ĞÑ‚ĞºÑ€Ñ‹Ğ²Ğ°ĞµÑ‚ Ğ¾ĞºĞ½Ğ¾ Ğ´Ğ»Ñ Ğ²Ñ…Ğ¾Ğ´Ğ°/Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ğ¸
      }

      // Ğ’Ñ‹Ñ…Ğ¾Ğ´ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
      function logout() {
        localStorage.removeItem('access_token');
        localStorage.removeItem('id_token');
        localStorage.removeItem('profile');
        window.location.href = window.location.origin; // ĞŸĞµÑ€ĞµĞ½Ğ°Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞµĞ¼ Ğ½Ğ° Ğ³Ğ»Ğ°Ğ²Ğ½ÑƒÑ ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ñƒ
      }

      // ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ñ Ğ°ÑƒÑ‚ĞµĞ½Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ğ¸
      function isAuthenticated() {
        return localStorage.getItem('access_token') != null;
      }

      // Ğ’Ñ‹Ğ·Ğ¾Ğ² Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ¸ Ğ°ÑƒÑ‚ĞµĞ½Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ğ¸ Ğ¿Ñ€Ğ¸ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞµ ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ñ‹
      window.onload = () => {
        handleAuthentication();
        if (isAuthenticated()) {
          document.getElementById('login-btn').style.display = 'none';
          document.getElementById('logout-btn').style.display = 'block';
          const profile = JSON.parse(localStorage.getItem('profile'));
          document.write(`<p>Welcome, ${profile.name}</p>`);
        }
      };
    </script>

    <!-- Custom scripts -->
    <script src="script.js"></script> 
</body>
</html>
